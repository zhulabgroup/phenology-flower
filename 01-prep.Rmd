# Preparation

```{r}
sessionInfo()
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, cache = TRUE)
```

```{r}
if (!requireNamespace("pacman", quietly = TRUE)) install.packages("pacman")
if (!requireNamespace("devtools", quietly = TRUE)) install.packages("devtools")

# List of required packages
required_packages <- c(
  "broom", "cowplot", "doSNOW", "dotenv", "foreach", "geosphere", "ggpubr", "ggrepel", "ggspatial", "ggthemes", "imputeTS", "knitr", "lmerTest", "lubridate", "magick", "mclust", "parallel", "patchwork", "ptw", "rnpn", "rsconnect", "scales", "sf", "shiny", "taxize", "terra", "tidyverse"
)

# Identify missing packages
missing_packages <- setdiff(required_packages, rownames(installed.packages()))

# Install if there are missing packages
if (length(missing_packages) > 0) {
  for (package in missing_packages) {
    pacman::p_install(package)
  }
} else {
  message("All required packages are already installed. Skipping installation.")
}

# Check and install tidynab from GitHub
if (!requireNamespace("tidynab", quietly = TRUE)) {
  devtools::install_github("zhulabgroup/tidynab")
}

pacman::p_load("tidyverse")
pacman::p_load("sf")
pacman::p_load("parallel")
pacman::p_load("doSNOW")
pacman::p_load("patchwork")

source("code/util_whit.R")
source("code/util_extend_ts.R")
```

```{r}
.path <- list(
  input = "alldata/input/",
  intermediate = "alldata/intermediate/",
  output = "alldata/output/"
)

.deploy_shiny <- F
.fig_save <- T
```

Taxa of interest are based on 1) [Lo et al.,2019](https://doi.org/10.1007/s10453-019-09601-2) (Description and allergenic potential of 11 most important pollen taxa in the CUSSC region ranked by percent abundance relative to the sum of all pollen taxa over 31 NAB stations that meet inclusion criteria, 2003â€“2017) and 2) [Crimmins et al., 2023](https://doi.org/10.1007/s00484-023-02506-3). Spring- and fall-flowering elms are treated separately as suggested by Allison and Yingxiao.
```{r}
v_taxa <- c("Acer", "Alnus", "Betula", "Carya", "Celtis", "Fraxinus", "Juglans", "Liquidambar", "Morus", "Platanus", "Populus", "Quercus", "Salix", "Ulmus early", "Ulmus late")
v_taxa_short <- str_split(v_taxa, pattern = " ", simplify = T)[, 1]
```

Focus on the life cycles from 2018 to 2022, spanning 2017 and 2023. This is because of the availability of PlanetScope data.
```{r fig.width=7, fig.height=5}
source("code/data_ps_dove.R")
p_dove
```

```{r}
v_year <- 2018:2022
```
