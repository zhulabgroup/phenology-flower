{
  "hash": "c3e18d3db49c9d6cda3b02d5bccbf479",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Predicting reproductive phenology of wind-pollinated trees via PlanetScope time series\"\nauthor: \"Yiluan Song\"\ndate: \"February 11, 2025\"\nformat: html\neditor: visual\n---\n\n\n# Preparation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif (!requireNamespace(\"pacman\", quietly = TRUE)) install.packages(\"pacman\")\nif (!requireNamespace(\"devtools\", quietly = TRUE)) install.packages(\"devtools\")\n\n# List of required packages\nrequired_packages <- c(\n  \"broom\", \"cowplot\", \"doSNOW\", \"dotenv\", \"foreach\", \"geosphere\", \"ggpubr\", \"ggrepel\", \"ggspatial\", \"ggthemes\", \"imputeTS\", \"knitr\", \"lmerTest\", \"lubridate\", \"magick\", \"mclust\", \"parallel\", \"patchwork\", \"ptw\", \"rnpn\", \"rsconnect\", \"scales\", \"sf\", \"shiny\", \"taxize\", \"terra\", \"tidyverse\"\n)\n\n# Identify missing packages\nmissing_packages <- setdiff(required_packages, rownames(installed.packages()))\n\n# Install if there are missing packages\nif (length(missing_packages) > 0) {\n  pacman::p_install(missing_packages)\n} else {\n  message(\"All required packages are already installed. Skipping installation.\")\n}\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nAll required packages are already installed. Skipping installation.\n```\n\n\n:::\n\n```{.r .cell-code}\n# Check and install tidynab from GitHub\nif (!requireNamespace(\"tidynab\", quietly = TRUE)) {\n  devtools::install_github(\"zhulabgroup/tidynab\")\n}\n\npacman::p_load(\"tidyverse\")\npacman::p_load(\"sf\")\npacman::p_load(\"parallel\")\npacman::p_load(\"doSNOW\")\npacman::p_load(\"patchwork\")\n\nsource(\"code/util_whit.R\")\nsource(\"code/util_extend_ts.R\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n.fig_save <- T\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n.path <- list(\n  out_fig = \"figures/\",\n  nab = \"data/input/nab/\",\n  occ = \"data/input/occurrence/\",\n  neon = \"data/input/neon/\",\n  npn = \"data/input/npn/\",\n  ps = \"data/input/ps/\",\n  dat_inter = \"data/intermediate/\",\n  dat_out = \"data/output/\"\n)\n```\n:::\n\n\nTaxa of interest are based on 1) [Lo et al.,2019](https://doi.org/10.1007/s10453-019-09601-2) (Description and allergenic potential of 11 most important pollen taxa in the CUSSC region ranked by percent abundance relative to the sum of all pollen taxa over 31 NAB stations that meet inclusion criteria, 2003–2017) and 2) [Crimmins et al., 2023](https://doi.org/10.1007/s00484-023-02506-3). Spring- and fall-flowering elms are treated separately as suggested by Allison and Yingxiao.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nv_taxa <- c(\"Acer\", \"Alnus\", \"Betula\", \"Carya\", \"Celtis\", \"Fraxinus\", \"Juglans\", \"Liquidambar\", \"Morus\", \"Platanus\", \"Populus\", \"Quercus\", \"Salix\", \"Ulmus early\", \"Ulmus late\")\nv_taxa_short <- str_split(v_taxa, pattern = \" \", simplify = T)[, 1]\n```\n:::\n\n\nFocus on the life cycles from 2018 to 2022, spanning 2017 and 2023. This is because of the availability of PlanetScope data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(here::here(\"code/data_ps_dove.R\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 14 Columns: 2\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\ndbl  (1): number\ndate (1): date\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\np_dove\n```\n\n::: {.cell-output-display}\n![](vignette_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nv_year <- 2018:2022\n```\n:::\n\n\n# Tree-level flowering phenology\n\nPlanetScope-derived vegetative phenology correlates with flowering phenology derived from NEON.\n\n## Data\n\nRead NEON phenometrics data prepared in a previous project.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(here::here(\"code/neon_data_pheno.R\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 8989 Columns: 11\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (7): site, id, scientific_name, growth_form, genus, species, family\ndbl (4): site_lat, site_lon, lat, lon\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\nRows: 84716 Columns: 7\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (4): site, id, event, tag\ndbl (3): event_code, year, first_yes_doy\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n`summarise()` has grouped output by 'site', 'id', 'event'. You can override using the `.groups` argument.\n```\n\n\n:::\n\n```{.r .cell-code}\np_neon_map\n```\n\n::: {.cell-output-display}\n![](vignette_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nRead in NEON PlanetScope data (day of year) prepared with our own batchplanet package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_neon_doy <- read_rds(str_c(.path$ps,\"df_neon_doy.rds\"))\ndf_neon_evi <- read_rds(str_c(.path$ps,\"df_neon_evi.rds\"))\nsource(\"code/neon_plot_data.R\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nJoining with `by = join_by(id)`\nJoining with `by = join_by(id)`\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Returning more (or less) than 1 row per `summarise()` group was deprecated in\ndplyr 1.1.0.\nℹ Please use `reframe()` instead.\nℹ When switching from `summarise()` to `reframe()`, remember that `reframe()`\n  always returns an ungrouped data frame and adjust accordingly.\nℹ The deprecated feature was likely used in the tidyr package.\n  Please report the issue at <https://github.com/tidyverse/tidyr/issues>.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRegistered S3 method overwritten by 'quantmod':\n  method            from\n  as.zoo.data.frame zoo \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 6072 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 2892 rows containing missing values or values outside the scale range\n(`geom_line()`).\n```\n\n\n:::\n\n```{.r .cell-code}\np_neon_data\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 6072 rows containing missing values or values outside the scale range\n(`geom_point()`).\nRemoved 2892 rows containing missing values or values outside the scale range\n(`geom_line()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](vignette_files/figure-html/unnamed-chunk-8-1.png){width=864}\n:::\n:::\n\n\n## Analysis\n\nCorrelation between 50% green-up time from PlanetScope and flower onset time from NEON.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(\"code/neon_corr.R\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Guides provided to `guides()` must be named.\nℹ The 3rd guide is unnamed.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n```{.r .cell-code}\np_neon_ps_corr_flower\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](vignette_files/figure-html/unnamed-chunk-9-1.png){width=960}\n:::\n:::\n\n\nCorrelation between leaf and flower onset time from NEON.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(\"code/neon_leaf_flower.R\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nJoining with `by = join_by(species_parse)`\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n```{.r .cell-code}\np_neon_leaf_flower\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](vignette_files/figure-html/unnamed-chunk-10-1.png){width=960}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 6072 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 2892 rows containing missing values or values outside the scale range\n(`geom_line()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Too few patch areas to hold all plots. Dropping plots\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Individual phenological observations extracted from PlanetScope (PS) and National Ecological Observatory Network (NEON) for wind-pollinated taxa. (A) Extraction of individual-level phenological metric from PS data, showing Enhanced Vegetation Index (black point), smoothed Enhanced Vegetation Index (green line), period of green-up (green shade), and extracted 50% green-up time (vertical green line), using two individuals at HARV and ORNL sites as examples. (B) Correlation between time of 50% green-up from PS and time of flower onset from NEON.](vignette_files/figure-html/unnamed-chunk-11-1.png){width=960}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}