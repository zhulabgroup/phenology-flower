{"title":"Predicting reproductive phenology of wind-pollinated trees via PlanetScope time series","markdown":{"yaml":{"title":"Predicting reproductive phenology of wind-pollinated trees via PlanetScope time series","author":"Yiluan Song","date":"`r format(Sys.time(), '%B %d, %Y')`","format":"html","editor":"visual"},"headingText":"Preparation","containsRefs":false,"markdown":"\n\n\n```{r}\nif (!requireNamespace(\"pacman\", quietly = TRUE)) install.packages(\"pacman\")\nif (!requireNamespace(\"devtools\", quietly = TRUE)) install.packages(\"devtools\")\n\n# List of required packages\nrequired_packages <- c(\n  \"broom\", \"cowplot\", \"doSNOW\", \"dotenv\", \"foreach\", \"geosphere\", \"ggpubr\", \"ggrepel\", \"ggspatial\", \"ggthemes\", \"imputeTS\", \"knitr\", \"lmerTest\", \"lubridate\", \"magick\", \"mclust\", \"parallel\", \"patchwork\", \"ptw\", \"rnpn\", \"rsconnect\", \"scales\", \"sf\", \"shiny\", \"taxize\", \"terra\", \"tidyverse\"\n)\n\n# Identify missing packages\nmissing_packages <- setdiff(required_packages, rownames(installed.packages()))\n\n# Install if there are missing packages\nif (length(missing_packages) > 0) {\n  pacman::p_install(missing_packages)\n} else {\n  message(\"All required packages are already installed. Skipping installation.\")\n}\n\n# Check and install tidynab from GitHub\nif (!requireNamespace(\"tidynab\", quietly = TRUE)) {\n  devtools::install_github(\"zhulabgroup/tidynab\")\n}\n\npacman::p_load(\"tidyverse\")\npacman::p_load(\"sf\")\npacman::p_load(\"parallel\")\npacman::p_load(\"doSNOW\")\npacman::p_load(\"patchwork\")\n\nsource(\"code/util_whit.R\")\nsource(\"code/util_extend_ts.R\")\n```\n\n```{r}\n.fig_save <- T\n```\n\n```{r}\n.path <- list(\n  out_fig = \"figures/\",\n  nab = \"data/input/nab/\",\n  occ = \"data/input/occurrence/\",\n  neon = \"data/input/neon/\",\n  npn = \"data/input/npn/\",\n  ps = \"data/input/ps/\",\n  dat_inter = \"data/intermediate/\",\n  dat_out = \"data/output/\"\n)\n```\n\nTaxa of interest are based on 1) [Lo et al.,2019](https://doi.org/10.1007/s10453-019-09601-2) (Description and allergenic potential of 11 most important pollen taxa in the CUSSC region ranked by percent abundance relative to the sum of all pollen taxa over 31 NAB stations that meet inclusion criteria, 2003–2017) and 2) [Crimmins et al., 2023](https://doi.org/10.1007/s00484-023-02506-3). Spring- and fall-flowering elms are treated separately as suggested by Allison and Yingxiao.\n\n```{r}\nv_taxa <- c(\"Acer\", \"Alnus\", \"Betula\", \"Carya\", \"Celtis\", \"Fraxinus\", \"Juglans\", \"Liquidambar\", \"Morus\", \"Platanus\", \"Populus\", \"Quercus\", \"Salix\", \"Ulmus early\", \"Ulmus late\")\nv_taxa_short <- str_split(v_taxa, pattern = \" \", simplify = T)[, 1]\n```\n\nFocus on the life cycles from 2018 to 2022, spanning 2017 and 2023. This is because of the availability of PlanetScope data.\n\n```{r}\n#| fig.width: 7\n#| fig.height: 5\nsource(here::here(\"code/data_ps_dove.R\"))\np_dove\n```\n\n```{r}\nv_year <- 2018:2022\n```\n\n# Tree-level flowering phenology\n\nPlanetScope-derived vegetative phenology correlates with flowering phenology derived from NEON.\n\n## Data\n\nRead NEON phenometrics data prepared in a previous project.\n\n```{r}\n#| fig.width: 7\n#| fig.height: 4\nsource(here::here(\"code/neon_data_pheno.R\"))\np_neon_map\n```\n\nRead in NEON PlanetScope data (day of year) prepared with our own batchplanet package.\n\n```{r}\n#| fig.width: 9\n#| fig.height: 6\ndf_neon_doy <- read_rds(str_c(.path$ps,\"df_neon_doy.rds\"))\ndf_neon_evi <- read_rds(str_c(.path$ps,\"df_neon_evi.rds\"))\nsource(\"code/neon_plot_data.R\")\np_neon_data\n```\n\n## Analysis\n\nCorrelation between 50% green-up time from PlanetScope and flower onset time from NEON.\n\n```{r}\n#| fig.width: 10\n#| fig.height: 6\nsource(\"code/neon_corr.R\")\np_neon_ps_corr_flower\n```\n\nCorrelation between leaf and flower onset time from NEON.\n\n```{r}\n#| fig.width: 10\n#| fig.height: 6\nsource(\"code/neon_leaf_flower.R\")\np_neon_leaf_flower\n```\n\n```{r}\n#| fig.width: 10\n#| fig.height: 6\n#| echo: false\n#| fig.cap: \"Individual phenological observations extracted from PlanetScope (PS) and National Ecological Observatory Network (NEON) for wind-pollinated taxa. (A) Extraction of individual-level phenological metric from PS data, showing Enhanced Vegetation Index (black point), smoothed Enhanced Vegetation Index (green line), period of green-up (green shade), and extracted 50% green-up time (vertical green line), using two individuals at HARV and ORNL sites as examples. (B) Correlation between time of 50% green-up from PS and time of flower onset from NEON.\"\np_neon_data +\n  p_neon_ps_corr_flower +\n  p_neon_leaf_flower +\n  plot_layout(\n    design = \"\n  A\n  B\n\",\n    heights = c(1, 1)\n  ) +\n  plot_annotation(tag_levels = \"A\")\n```\n","srcMarkdownNoYaml":"\n\n# Preparation\n\n```{r}\nif (!requireNamespace(\"pacman\", quietly = TRUE)) install.packages(\"pacman\")\nif (!requireNamespace(\"devtools\", quietly = TRUE)) install.packages(\"devtools\")\n\n# List of required packages\nrequired_packages <- c(\n  \"broom\", \"cowplot\", \"doSNOW\", \"dotenv\", \"foreach\", \"geosphere\", \"ggpubr\", \"ggrepel\", \"ggspatial\", \"ggthemes\", \"imputeTS\", \"knitr\", \"lmerTest\", \"lubridate\", \"magick\", \"mclust\", \"parallel\", \"patchwork\", \"ptw\", \"rnpn\", \"rsconnect\", \"scales\", \"sf\", \"shiny\", \"taxize\", \"terra\", \"tidyverse\"\n)\n\n# Identify missing packages\nmissing_packages <- setdiff(required_packages, rownames(installed.packages()))\n\n# Install if there are missing packages\nif (length(missing_packages) > 0) {\n  pacman::p_install(missing_packages)\n} else {\n  message(\"All required packages are already installed. Skipping installation.\")\n}\n\n# Check and install tidynab from GitHub\nif (!requireNamespace(\"tidynab\", quietly = TRUE)) {\n  devtools::install_github(\"zhulabgroup/tidynab\")\n}\n\npacman::p_load(\"tidyverse\")\npacman::p_load(\"sf\")\npacman::p_load(\"parallel\")\npacman::p_load(\"doSNOW\")\npacman::p_load(\"patchwork\")\n\nsource(\"code/util_whit.R\")\nsource(\"code/util_extend_ts.R\")\n```\n\n```{r}\n.fig_save <- T\n```\n\n```{r}\n.path <- list(\n  out_fig = \"figures/\",\n  nab = \"data/input/nab/\",\n  occ = \"data/input/occurrence/\",\n  neon = \"data/input/neon/\",\n  npn = \"data/input/npn/\",\n  ps = \"data/input/ps/\",\n  dat_inter = \"data/intermediate/\",\n  dat_out = \"data/output/\"\n)\n```\n\nTaxa of interest are based on 1) [Lo et al.,2019](https://doi.org/10.1007/s10453-019-09601-2) (Description and allergenic potential of 11 most important pollen taxa in the CUSSC region ranked by percent abundance relative to the sum of all pollen taxa over 31 NAB stations that meet inclusion criteria, 2003–2017) and 2) [Crimmins et al., 2023](https://doi.org/10.1007/s00484-023-02506-3). Spring- and fall-flowering elms are treated separately as suggested by Allison and Yingxiao.\n\n```{r}\nv_taxa <- c(\"Acer\", \"Alnus\", \"Betula\", \"Carya\", \"Celtis\", \"Fraxinus\", \"Juglans\", \"Liquidambar\", \"Morus\", \"Platanus\", \"Populus\", \"Quercus\", \"Salix\", \"Ulmus early\", \"Ulmus late\")\nv_taxa_short <- str_split(v_taxa, pattern = \" \", simplify = T)[, 1]\n```\n\nFocus on the life cycles from 2018 to 2022, spanning 2017 and 2023. This is because of the availability of PlanetScope data.\n\n```{r}\n#| fig.width: 7\n#| fig.height: 5\nsource(here::here(\"code/data_ps_dove.R\"))\np_dove\n```\n\n```{r}\nv_year <- 2018:2022\n```\n\n# Tree-level flowering phenology\n\nPlanetScope-derived vegetative phenology correlates with flowering phenology derived from NEON.\n\n## Data\n\nRead NEON phenometrics data prepared in a previous project.\n\n```{r}\n#| fig.width: 7\n#| fig.height: 4\nsource(here::here(\"code/neon_data_pheno.R\"))\np_neon_map\n```\n\nRead in NEON PlanetScope data (day of year) prepared with our own batchplanet package.\n\n```{r}\n#| fig.width: 9\n#| fig.height: 6\ndf_neon_doy <- read_rds(str_c(.path$ps,\"df_neon_doy.rds\"))\ndf_neon_evi <- read_rds(str_c(.path$ps,\"df_neon_evi.rds\"))\nsource(\"code/neon_plot_data.R\")\np_neon_data\n```\n\n## Analysis\n\nCorrelation between 50% green-up time from PlanetScope and flower onset time from NEON.\n\n```{r}\n#| fig.width: 10\n#| fig.height: 6\nsource(\"code/neon_corr.R\")\np_neon_ps_corr_flower\n```\n\nCorrelation between leaf and flower onset time from NEON.\n\n```{r}\n#| fig.width: 10\n#| fig.height: 6\nsource(\"code/neon_leaf_flower.R\")\np_neon_leaf_flower\n```\n\n```{r}\n#| fig.width: 10\n#| fig.height: 6\n#| echo: false\n#| fig.cap: \"Individual phenological observations extracted from PlanetScope (PS) and National Ecological Observatory Network (NEON) for wind-pollinated taxa. (A) Extraction of individual-level phenological metric from PS data, showing Enhanced Vegetation Index (black point), smoothed Enhanced Vegetation Index (green line), period of green-up (green shade), and extracted 50% green-up time (vertical green line), using two individuals at HARV and ORNL sites as examples. (B) Correlation between time of 50% green-up from PS and time of flower onset from NEON.\"\np_neon_data +\n  p_neon_ps_corr_flower +\n  p_neon_leaf_flower +\n  plot_layout(\n    design = \"\n  A\n  B\n\",\n    heights = c(1, 1)\n  ) +\n  plot_annotation(tag_levels = \"A\")\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"vignette.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.553","title":"Predicting reproductive phenology of wind-pollinated trees via PlanetScope time series","author":"Yiluan Song","date":"`r format(Sys.time(), '%B %d, %Y')`","editor":"visual"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":[]}