
```{r, eval=TRUE}
source("code/prep_setup.R")
```

```{r, eval=TRUE}
source("code/prep_scope.R")
```

* Taxa of interest are based on [Description and allergenic potential of 11 most important pollen taxa in the CUSSC region ranked by percent abundance relative to the sum of all pollen taxa over 31 NAB stations that meet inclusion criteria, 2003â€“2017] (https://link.springer.com/article/10.1007/s10453-019-09601-2/tables/2)
* Spring- and fall-flowering elms are treated separately as suggested by Allison and Yingxiao.
* I decide to separate grasses into early and late-flowering groups as well because many cities have two pollen peaks.
```{r, eval=TRUE}
v_taxa
```

* Eight major cities in CONUS with pollen count data and street tree inventory.
* Detroit also has info of oak trees with ground observed flowering phenology.
```{r, eval=TRUE}
v_site_name
```

* Focus on the life cycles from 2018 to 2022, spanning 2017 and 2023.
```{r, eval=TRUE}
v_year
```

# Data
## NAB data
Read in data using tidynab package.
```{r, eval=T}
source("code/data_nab_read.R")
```

Focus on seven cities.
* Exceptions: Denver pollen data are from Colorado Springs; Austin pollen data are from Georgetown; Detroit pollen data are from Sylvania.
```{r, eval=TRUE}
source("code/data_nab_meta.R")
p_pollen_map
```

```{r, eval=TRUE}
source("code/data_nab_avail.R")
p_nab_avail
```

View pollen phenology in study sites.
```{r, eval=TRUE}
source("code/data_nab_pheno.R")
p_nab_calen
```

```{r}
source("code/data_nab_window.R")
p_flower_window
```

## Plant location data

Read in data previously processed with batchplanet package.
```{r, eval=T}
source("code/data_occ_tree_read.R")
```

Find family names from genus names. This step needs supervision.
```{r, eval=T}
source("code/data_occ_tree_taxa.R")
```

Map relative position of tree inventory and nab station.
```{r, eval=TRUE}
source("code/data_occ_map.R")
p_nab_plant_map
```

Calculate distance from plants to NAB stations in the unit of km.
```{r, eval=TRUE}
source("code/data_occ_dist.R")
df_distance
```

Prepare street map as basemap. Street shapefiles for major cities manually downloaded from https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/CUWWYJ.
Boeing, Geoff, 2017, "U.S. Street Network Shapefiles, Node/Edge Lists, and GraphML Files", https://doi.org/10.7910/DVN/CUWWYJ, Harvard Dataverse, V2
```{r, eval=TRUE}
source("code/data_occ_road_read.R")
```

Map plant occurrence in a city.
```{r, eval=TRUE, fig.width=12, fig.height=30}
source("code/data_occ_road_map.R")
p_plant_map
```

## Climate data
```{r, eval=TRUE}
source("code/data_chelsa.R")
df_chelsa
```

Climatologies.
```{r, eval=TRUE}
source("code/data_terraclim.R")
df_terraclim
```

Annual summaries.
```{r, eval=TRUE}
source("code/data_terraclim_annual.R")
df_terraclim_annual
```

## PlanetScope data

```{r, eval=TRUE, echo=FALSE}
source("code/data_ps_dove.R")
p_dove
```

```{r, eval = TRUE}
source("code/data_ps_snap.R")
p_ps_snap
```

PS data previously processed using batchplanet package.
