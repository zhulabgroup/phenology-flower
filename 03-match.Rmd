# Match pollen phenology with leafing phenology
Conceptual figure.
```{r, eval=TRUE}
source("code/city_concept.R")
p_conceptual
```

## Characterize leafing phenology for all taxa and cities
Set green-up/down thresholds for each taxa.
```{r}
source("code/city_prep.R")
```

Read in green-up down day of year previously processed using the batchplanet package.
```{r, eval = F}
source("code/city_doy.R")
```

Convert into probability density.
```{r, eval = FALSE}
source("code/city_freq.R")
```

## Tune threshold and time lag with pollen data
```{r, eval=FALSE}
source("code/city_data.R")
```

```{r}
source("code/city_plot.R")
```

```{r, eval = F}
source("code/city_tune.R")
```

## Results
Prepare for Shiny app by copying result figures to the current folder. Shiny app code is in ./shinyapp/app.R. Needs to deploy app once every time results are changed.
```{r, eval=FALSE}
source("code/city_shiny.R")
```

Display results in a Shiny app.
```{r, eval=TRUE, cache=FALSE}
knitr::include_app("https://yiluansong.shinyapps.io/RS4flower_result/", height = "600px")
```

```{r}
source("code/city_plot_subset.R")
```

```{r, fig.width=8, fig.height=6}
p_comp_1city
```

```{r, fig.width=8, fig.height=10}
p_comp_1taxa
```

```{r}
p_comp_1taxa2city
```

```{r, fig.width=12, fig.height=6}
p_city_corr
```

Visualize matching results for all taxa in New York.
```{r, eval=FALSE}
source("code/map_tidy.R")
```

```{r, eval=TRUE}
source("code/map_plot.R")
```

```{r, fig.width=8, fig.height=6}
p_doy_variation
p_plant_map_doy
```
